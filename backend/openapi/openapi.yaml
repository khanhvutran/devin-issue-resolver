openapi: "3.0.3"
info:
  title: Devin API
  version: "1.0.0"

paths:
  /api/health:
    get:
      operationId: app.routes.health.health_check
      summary: Health check
      description: Verify the API is running
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthOut"
  /api/issues:
    get:
      operationId: app.routes.issues.issues
      summary: Github Issues
      description: Returns list of github issues for a given repository
      parameters:
        - name: github_url
          in: query
          required: true
          schema:
            type: string
          description: GitHub repository URL (e.g. https://github.com/owner/repo)
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Issue"
  /api/devin/analyze:
    post:
      operationId: app.routes.devin.analyze
      summary: Start Devin analysis
      description: Creates a Devin session to analyze a GitHub issue
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AnalyzeRequest"
      responses:
        "202":
          description: Analysis started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalyzeResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/devin/analysis:
    get:
      operationId: app.routes.devin.get_analysis_status
      summary: Get analysis status
      description: Returns the current status and results of a Devin analysis
      parameters:
        - name: github_url
          in: query
          required: true
          schema:
            type: string
          description: GitHub repository URL
        - name: issue_id
          in: query
          required: true
          schema:
            type: integer
          description: Issue number
      responses:
        "200":
          description: Analysis found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AnalysisResult"
        "404":
          description: Analysis not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      operationId: app.routes.devin.remove_analysis
      summary: Delete analysis
      description: Deletes a Devin analysis for a GitHub issue
      parameters:
        - name: github_url
          in: query
          required: true
          schema:
            type: string
          description: GitHub repository URL
        - name: issue_id
          in: query
          required: true
          schema:
            type: integer
          description: Issue number
      responses:
        "204":
          description: Analysis deleted
        "404":
          description: Analysis not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/devin/fix:
    post:
      operationId: app.routes.devin.fix_issue
      summary: Start Devin fix
      description: Creates a Devin session to implement a fix and create a PR
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FixRequest"
      responses:
        "202":
          description: Fix started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FixResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/devin/fix-status:
    get:
      operationId: app.routes.devin.get_fix_status
      summary: Get fix status
      description: Returns the current status of a Devin fix session
      parameters:
        - name: github_url
          in: query
          required: true
          schema:
            type: string
          description: GitHub repository URL
        - name: issue_id
          in: query
          required: true
          schema:
            type: integer
          description: Issue number
      responses:
        "200":
          description: Fix status found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FixStatusResult"
        "404":
          description: Fix not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    HealthOut:
      type: object
      required:
        - message
        - status
      properties:
        message:
          type: string
        status:
          type: string
    Issue:
      type: object
      required:
        - issue_id
        - issue_title
        - state
        - author
        - created_at
        - comment_count
      properties:
        issue_id:
          type: integer
        issue_title:
          type: string
        body:
          type: string
        state:
          type: string
        author:
          type: string
        author_avatar:
          type: string
        labels:
          type: array
          items:
            $ref: "#/components/schemas/Label"
        created_at:
          type: string
        comment_count:
          type: integer
    Label:
      type: object
      required:
        - name
        - color
      properties:
        name:
          type: string
        color:
          type: string
    AnalyzeRequest:
      type: object
      required:
        - github_url
        - issue_id
        - issue_title
      properties:
        github_url:
          type: string
          description: GitHub repository URL
        issue_id:
          type: integer
          description: Issue number
        issue_title:
          type: string
          description: Issue title
    AnalyzeResponse:
      type: object
      required:
        - session_id
        - status
      properties:
        session_id:
          type: string
        status:
          type: string
        devin_url:
          type: string
    AnalysisResult:
      type: object
      required:
        - github_url
        - issue_id
        - status
      properties:
        github_url:
          type: string
        issue_id:
          type: integer
        session_id:
          type: string
        status:
          type: string
        plan:
          type: string
          nullable: true
        confidence_score:
          type: integer
          nullable: true
        devin_url:
          type: string
          nullable: true
        created_at:
          type: string
          nullable: true
        updated_at:
          type: string
          nullable: true
    FixRequest:
      type: object
      required:
        - github_url
        - issue_id
        - issue_title
        - plan
      properties:
        github_url:
          type: string
          description: GitHub repository URL
        issue_id:
          type: integer
          description: Issue number
        issue_title:
          type: string
          description: Issue title
        plan:
          type: string
          description: Implementation plan from analysis
    FixResponse:
      type: object
      required:
        - session_id
        - status
      properties:
        session_id:
          type: string
        status:
          type: string
        devin_url:
          type: string
    FixStatusResult:
      type: object
      required:
        - github_url
        - issue_id
      properties:
        github_url:
          type: string
        issue_id:
          type: integer
        fix_status:
          type: string
          nullable: true
        fix_session_id:
          type: string
          nullable: true
        fix_devin_url:
          type: string
          nullable: true
        pr_url:
          type: string
          nullable: true
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
